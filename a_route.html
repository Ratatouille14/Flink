
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <!--link color : black-->
        <style type="text/css">
            a:link {color:black; text-decoration:none;}
            a:visited {color:black; text-decoration: none;}
            a:hover {color:black; text-decoration:none;}
            a:active {color:black; text-decoration:none;}
        </style>

        <style>
            #test_btn1{
                border: 1px solid #4169E1;
                background-color:#4169E1;
                color:white;
                margin-right: 5px;

            }
            #test_btn2{
                border: 1px solid #4169E1;
                background-color: rgba(0,0,0,0);
                color: #4169E1;
                margin-right: 5px;

            }
            #test_btn3{
                border: 1px solid #4169E1;
                background-color: rgba(0,0,0,0);
                color: #4169E1;

            }

            #btn_group button{
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                border-bottom-left-radius: 5px;
                border-bottom-right-radius:5px;

  
                padding:5px;
            }
            #btn_group button:hover{
                color:white;
                background-color:#4169E1;

            }
        </style>




        <!-- Bootstrap core CSS -->
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom fonts for this template -->
        <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
        <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

        <!-- Custom styles for this template -->
        <link href="css/landing-page.min.css" rel="stylesheet">



        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Flink 경로 안내</title>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=l7xx84909dae75d54ef8a634e5f6be023dd1"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script type="text/javascript">
            
            

                var data;
                data=[
        {
            "name": "경기도 성남시 분당구 황새울로319번길 8-4",
            "coordinates": [
                37.38557851,
                127.1209423
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 2
        },
        {
            "name": "경기도 성남시 분당구 황새울로319번길 8-6",
            "coordinates": [
                37.38566929,
                127.12114229999999
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 3
        },
        {
            "name": "경기도 성남시 분당구 황새울로 325",
            "coordinates": [
                37.38556654,
                127.121426
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 13",
            "coordinates": [
                37.38460972,
                127.1487362
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 3
        },
        {
            "name": "경기도 성남시 분당구 새마을로177번길 5",
            "coordinates": [
                37.38409618,
                127.14994509999998
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 만세길 8",
            "coordinates": [
                37.38370045,
                127.15136820000001
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 2
        }
    ];

    var mdata;
    mdata = [
        {
            "name": "경기도 성남시 분당구 만세길 8",
            "coordinates": [
                37.38370045,
                127.15136820000001
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 2
        },
        {
            "name": "경기도 성남시 분당구 만세길 5",
            "coordinates": [
                37.38390058,
                127.1512571
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 문정로148번길 6",
            "coordinates": [
                37.38321524,
                127.1515222
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 1
        },
        {
            "name": "경기도 성남시 분당구 문정로148번길 14",
            "coordinates": [
                37.38360768,
                127.1520047
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 13",
            "coordinates": [
                37.38460972,
                127.1487362
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 3
        },
        {
            "name": "경기도 성남시 분당구 새마을로177번길 7-8",
            "coordinates": [
                37.384665600000005,
                127.14934309999998
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 1
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 19",
            "coordinates": [
                37.3850689,
                127.148924
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 2
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 9",
            "coordinates": [
                37.38424176,
                127.14888329999998
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 1
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 6",
            "coordinates": [
                37.38387526,
                127.1491554
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 1
        },
        {
            "name": "경기도 성남시 분당구 새마을로175번길 9",
            "coordinates": [
                37.38410067,
                127.1491777
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 새마을로177번길 5",
            "coordinates": [
                37.38409618,
                127.14994509999998
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 1,
            "weight": 4
        },
        {
            "name": "경기도 성남시 분당구 새마을로165번길 20",
            "coordinates": [
                37.38492535,
                127.1495142
            ],
            "team_num": 3,
            "area_num": 10,
            "capacity": 2,
            "weight": 3
        }
    ];

                var map;
                
                var marker_s, marekr_e, waypoint;
                var resultMarkerArr = [];
                //경로그림정보
                var drawInfoArr = [];
                var resultInfoArr = [];
                
                function initTmap(){
                    resultMarkerArr = [];
                    
                    //지도
                    map = new Tmapv2.Map("map_div", {
                        center: new Tmapv2.LatLng(37.384036, 127.134071),
                        width : "355px",
                        height : "300px",
                        zoom : 13,
                        zoomControl : true,
                        scrollwheel : true
                        
                    });
                    
                  
                    //시작, 도착 마커
                    //시작
                    marker_s = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38253727,
                127.1516305),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker_s);
                    
                    
                    //경유지
                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38265607,
                127.15178459999998),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38390058,
                127.1512571),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_2.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38410693,
                127.15205959999999),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_3.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38471007,
                127.1529287),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_4.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38761567,
                127.15480749999999),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_5.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38683922,
                127.1254827),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_6.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38556654,
                127.121426),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_7.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(37.38427649,
                127.1495602),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_8.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    



                    
                    
                    
                    
                    
                    //micro mobility 배송지
                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[0].coordinates[0], mdata[0].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[1].coordinates[0], mdata[1].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[2].coordinates[0], mdata[2].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[3].coordinates[0], mdata[3].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[4].coordinates[0], mdata[4].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[5].coordinates[0], mdata[5].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[6].coordinates[0], mdata[6].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[7].coordinates[0], mdata[7].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);

                    marker = new Tmapv2.Marker({
                        position : new Tmapv2.LatLng(mdata[8].coordinates[0], mdata[8].coordinates[1]),
                        icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_g_m_1.png",
                        iconSize : new Tmapv2.Size(24, 38),
                        map:map
                    });
                    resultMarkerArr.push(marker);




                    




                    
                    //경로탐색 API 사용요청
                    var routeLayer; 
                    $("#btn_select").click(function(){
                
                        var searchOption = $("#selectLevel").val();
                        
                        var headers = {}; 
                        headers["appKey"]="l7xx84909dae75d54ef8a634e5f6be023dd1";
                        headers["Content-Type"]="application/json";
                        
                        var param = JSON.stringify({
                            "startName" : "출발지",
                            "startX" : "127.1516305",
                            "startY" : "37.38253727",
                            "startTime" : "202005201103",
                            "endName" : "도착지",
                            "endX" : "127.1516305",
                            "endY" : "37.38253727",
                            "viaPoints" : 
                                [
                                 {
                                     "viaPointId" : "test01",
                                     "viaPointName" : "name01",
                                     "viaX" : "127.15178459999998" ,//
                                     "viaY" : "37.38265607" //
                                 },
                                 {
                                     "viaPointId" : "test02",
                                     "viaPointName" : "name02",
                                     "viaX" : "127.1512571" ,//
                                     "viaY" : "37.38390058" //
                                 },
                                 {
                                     "viaPointId" : "test03",
                                     "viaPointName" : "name03",
                                     "viaX" : "127.15205959999999" ,//
                                     "viaY" : "37.38410693" //
                                 }
                                 ,
                                 {
                                     "viaPointId" : "test04",
                                     "viaPointName" : "name04",
                                     "viaX" : "127.1529287" ,//
                                     "viaY" : "37.38471007" //
                                 }
                                 ,
                                 {
                                     "viaPointId" : "test05",
                                     "viaPointName" : "name05",
                                     "viaX" : "127.15480749999999" ,//
                                     "viaY" : "37.38761567" //
                                 }
                                 ,
                                 {
                                     "viaPointId" : "test06",
                                     "viaPointName" : "name06",
                                     "viaX" : "127.1254827" ,//
                                     "viaY" : "37.38683922" //
                                 }
                                 ,
                                 {
                                     "viaPointId" : "test07",
                                     "viaPointName" : "name07",
                                     "viaX" : "127.121426" ,//
                                     "viaY" : "37.38556654" //
                                 }
                                 ,
                                 {
                                     "viaPointId" : "test08",
                                     "viaPointName" : "name08",
                                     "viaX" : "127.1495602" ,//
                                     "viaY" : "37.38427649" //
                                 }
                                ],
                            "reqCoordType" : "WGS84GEO",
                            "resCoordType" : "EPSG3857",
                            "searchOption": searchOption
                        });
                        
                        $.ajax({
                                method:"POST",
                                url:"https://apis.openapi.sk.com/tmap/routes/routeSequential30?version=1&format=json",//
                                headers : headers,
                                async:false,
                                data:param,
                                success:function(response){
                
                                    var resultData = response.properties;
                                    var resultFeatures = response.features;
                                    
                                    
                                    
                                    //기존  라인 초기화
                                    
                                    if(resultInfoArr.length>0){
                                        for(var i in resultInfoArr){
                                            resultInfoArr[i].setMap(null);
                                        }
                                        resultInfoArr=[];
                                    }
                                    
                                    for(var i in resultFeatures) {
                                        var geometry = resultFeatures[i].geometry;
                                        var properties = resultFeatures[i].properties;
                                        var polyline_;
                                        
                                        drawInfoArr = [];
                                        
                                        if(geometry.type == "LineString") {
                                            for(var j in geometry.coordinates){
                                                // 경로들의 결과값(구간)들을 포인트 객체로 변환 
                                                var latlng = new Tmapv2.Point(geometry.coordinates[j][0], geometry.coordinates[j][1]);
                                                // 포인트 객체를 받아 좌표값으로 변환
                                                var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(latlng);
                                                // 포인트객체의 정보로 좌표값 변환 객체로 저장
                                                var convertChange = new Tmapv2.LatLng(convertPoint._lat, convertPoint._lng);
                                                
                                                drawInfoArr.push(convertChange);
                                            }
                
                                            polyline_ = new Tmapv2.Polyline({
                                                path : drawInfoArr,
                                                strokeColor : "#000000",
                                                strokeWeight: 6,
                                                map : map
                                            });
                                            resultInfoArr.push(polyline_);
                                            
                                        }else{
                                            var markerImg = "";
                                            var size = "";          //아이콘 크기 설정
                                            
                                            if(properties.pointType == "S"){    //출발지 마커
                                                markerImg = "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png";   
                                                size = new Tmapv2.Size(24, 38);
                                            }else if(properties.pointType == "E"){  //도착지 마커
                                                markerImg = "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png";
                                                size = new Tmapv2.Size(24, 38);
                                            }else{  //각 포인트 마커
                                                markerImg = "http://topopen.tmap.co.kr/imgs/point.png";
                                                size = new Tmapv2.Size(8, 8);
                                            }
                                            
                                            // 경로들의 결과값들을 포인트 객체로 변환 
                                            var latlon = new Tmapv2.Point(geometry.coordinates[0], geometry.coordinates[1]);
                                            // 포인트 객체를 받아 좌표값으로 다시 변환
                                            var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(latlon);
                                            
                                            marker_p = new Tmapv2.Marker({
                                                position: new Tmapv2.LatLng(convertPoint._lat, convertPoint._lng),
                                                icon : markerImg,
                                                iconSize : size,
                                                map:map
                                            });
                                            
                                            resultMarkerArr.push(marker_p);
                                        }
                                    }
                                },
                                error:function(request,status,error){
                                    console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                                }
                            });
                    });

                }
            
                function addComma(num) {
                      var regexp = /\B(?=(\d{3})+(?!\d))/g;
                       return num.toString().replace(regexp, ',');
                }

            
        </script>
    </head>
    <body>


      <!-- Navigation -->
  <nav class="navbar navbar-light bg-light static-top">
    <div class="container">
      <a class="navbar-brand" href="a_index.html">Flink</a>
    </div>
  </nav>

  <!-- Masthead -->
  <header class="masthead text-white text-center">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-xl-9 mx-auto">
          <h1 class="mb-5">Flink 경로 안내</h1>
        </div>
      </div>
    </div>
  </header>



    <!-- 맵 생성 실행 -->

    <body onload="initTmap()">
   <div style="padding:40px 10px 40px 10px;">


    <div style="text-align: center;">
        <h4 style="font-size: 30px; display: inline-block;">A</h4>
        <h4 style="display: inline-block;"> 님의 오늘 배달할 물량은 </h4><br>
        <h4 style="font-size: 40px; color:#5050FF; display: inline-block;">30</h4>
        <h4 style="display: inline-block;"> 개 입니다!</h4>
    </div>

    <br>

    <div style="text-align: center;">
        <h4 style="display: inline-block;">배송 예정 소요 시간은</h4>
        <br>
        <h4 style="display: inline-block;">약 </h4>
        <h4 style="font-size: 30px; color:#5050FF; display: inline-block;"> 00 </h4>
        <h4 style="display: inline-block;"> 시간 </h4>
        <h4 style="font-size: 30px; color:#5050FF; display: inline-block;">32</h4>
        <h4 style="display: inline-block;"> 분 입니다.</h4>
    </div>

    <br>

    <div style="text-align: center;">
        <h4 style="display: inline-block;">모빌리티 환승 횟수는 총 </h4>
        <h4 style="font-size: 30px; color:#5050FF; display: inline-block;">3</h4>
        <h4 style="display: inline-block;"> 회 입니다.</h4>
    </div>

    <br> 
    <br>
    <hr width = 100% style="border:gray1px dashed">
    <br>
    <h5>트럭 경로 및 배송지 안내</h5>
    
    

    <p id="result"></p>
        <select id="selectLevel">
            <option value="0" selected="selected">교통최적+추천</option>
            <option value="1" >교통최적+무료우선</option>
            <option value="2" >교통최적+최소시간</option>
            <option value="3" >교통최적+초보</option>
        </select>

        <button 
        type="button"
        id="btn_select"> 적용 및 결과 출력 </button>

        <br>
        <br>
        <br>

            <div id="map_wrap" class="map_wrap">
                <div id="map_div"></div>
            </div>

        <br>
        <p>지도에 표시된 번호 순으로 배송하는 것을 권장합니다.</p>
        <p>파란색 포인트는 트럭 배송지이며, 검은색 포인트는 마이크로 모빌리티 배송지입니다.</p>
        <p>같은 번호는 한 번에 배송해야하며, 해당하는 포인트 중 파란색이 환승 지점입니다.</p>

        <br>
        <br>
</div>

  <!-- Footer -->
  <footer class="footer bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-6 h-100 text-center text-lg-left my-auto">
         
          <p class="text-muted small mb-4 mb-lg-0">&copy; Flink 2020. All Rights Reserved.</p>
        </div>
        
      </div>
    </div>
  </footer>


    </body>
</html> 